### 1. 文件权限
Linux系统使用了不同的字符来区分不同的文件，下面列出了一些常用的类型。
- -，普通文件。
- d，目录文件。
- l，链接文件。
- b，块设备文件。
- c，字符设备文件。
- p，管道文件

在Linux系统中，每个文件都有所属的所有者和所有组，并且规定了文件的所有者、所有组以及其他人对文件所拥有的可读(r)、可写(w)、可执行(x)等权限。

文件的读、写、执行权限可以简写为rwx，也可以用数字4、2、1来表示，文件权限可以用加法来表示，比如7则代表可读、可写、可执行(4+2+1)。
- 可读，表示能够读取文件的实际内容，对于目录文件来说表示能够读取目录内的文件列表。
- 可写，表示能够编辑、新增、修改、删除文件的实际内容，对于目录文件来说能够在目录内新增、删除、重命名文件。
- 可执行，示能够运行一个脚本程序，对于目录文件来说表示能够进入该目录。

```
权限分配          文件所有者        文件所属组        其他用户
权限项            读 写 执行        读 写 执行       读 写 执行
字符表示          r  w  x           r  w  x         r  w  x
数字表示          4  2  1           4  2  1         4  2  1
```

使用```ls -l```命令可以分别看到代表创建者，所属组和其他用户的权限情况，其中第一个root表示所属用户，第二个root表示所属组。
```
[root@VM_0_11_centos dev]# ls -l shell
total 4
-rwx------ 1 root root 75 Apr  6 10:52 test.sh
```

---

### 2. 文件的特殊权限
Linux系统中还有一种更灵活的特殊权限，如SUID、SGID与SBIT等特殊权限位。

- SUID

  是一种对二进制程序进行设置的特殊权限，可以让二进制程序的执行者临时拥有所属用户的权限(仅对拥有执行权限的二进制程序有效)。例如，本来只有root用户可以操作etc/shadow文件，该文件中存储了用户的密码，而```SUID```则可以让普通用户也可以临时操作这个文件。

  其实意思就是说普通用户对这个文件还是没有任何读，写和执行的权限，但是运行普通用户使用某个可执行程序来对这个文件进行操作，比如说```cat```命令就是一个二进制程序，给文件赋予```cat```的SUID权限后，普通用户就可以使用这个命令来操作文件了。

  比如下面对```cat```命令添加了```SUID```权限，所有者的权限由```rwx```变成了```rws```，这个时候普通用户就可以对没有权限的文件使用这个命令了，注意，如果原来没有```x```权限，则```rw-```会变成```rwS```。
  ```
  [test@VM_0_11_centos /]$ cat /etc/shadow
  cat: /etc/shadow: Permission denied
  
  [root@VM_0_11_centos bin]# chmod 4755 /bin/cat

  [root@VM_0_11_centos bin]# ls -l cat
  -rwsr-xr-x. 1 root root 54160 Oct 31  2018 cat
  ```


- ```SGID```则是类似于```SUID```命令，只是它是临时获取到文件所属组的权限。如果对目录使用该命令，则只要拥有写和执行的权限就可以在目录下创建文件，并且该文件都属于该目录所属的组。
  ```
  [root@VM_0_11_centos bin]# chmod 4755 /bin/cat

  [root@VM_0_11_centos bin]# ll cat
  -rwxrwsr-x. 1 root root 54160 Oct 31  2018 cat
  ```

- SBIT(StickyBit)
  
  可以确保只能删除自己的文件，不能删除其他用户的文件。当目录被设置```SBIT```特殊权限位后，文件的其他人权限部分的```x```执行权限就会被替换成```t```或者```T```，原本有```x```执行权限则会写成```t```，原本没有```x```执行权限则会被写成```T```。

  ```
  [root@VM_0_11_centos bin]# chmod 1775 cat

  [root@VM_0_11_centos bin]# ll cat
  -rwxrwxr-t. 1 root root 54160 Oct 31  2018 cat
  ```

---

### chmod、chown命令
```chmod```命令能够用来设置文件或目录的权限，格式为```chmod [参数] 权限 文件或目录名称```。

```
chmod 760 test
```

```chown```命令可以修改文件或目录的所有者和所属组的，格式为```chown[参数]所有者:所属组文件或目录名称```。注意，针对目录进行操作时需要加上大写参数```-R```来表示递归操作，即对目录内所有的文件进行整体操作。

```
chown root:test test
```

---

### chattr、lsattr命令

Linux系统中的文件除了具备一般权限和特殊权限之外，还有一种隐藏权限，默认情况下不能直接被用户发觉。例如仅能在日志文件中追加内容而不能修改或删除内容，这在一定程度上保障了Linux系统的安全性。

- chattr

  用于设置文件的隐藏权限，格式为```chattr[参数] 文件```

  ```
  chattr +a test
  ```
  常用参数
  - i，无法对文件进行修改，若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件
  - a，仅允许补充(追加)内容，无法覆盖/删除内容(AppendOnly)
  - S，文件内容在变更后立即同步到硬盘(sync)
  - s，彻底从硬盘中删除，不可恢复(用0填充原文件所在硬盘区域)
  - A，不再修改这个文件或目录的最后访问时间(atime)
  - b，不再修改文件或目录的存取时间
  - D，检查压缩文件中的错误
  - d，使用dump命令备份时忽略本文件/目录
  - c，默认将文件或目录进行压缩
  - u，当删除该文件后依然保留其在硬盘中的数据，方便日后恢复
  - t，让文件系统支持尾部合并(tail-merging)
  - X，可以直接访问压缩文件中的内容

- lsattr
  
  用于显示文件的隐藏权限，格式为```lsattr [参数] 文件```，隐藏权限必须使用lsattr命令来查看。




### 文件访问控制列表
上面提到的的权限命令都是针对一类用户的权限配置，如果希望对某个指定的用户进行单独的权限控制，就需要用到文件的访问控制列表(ACL)，其实本质上来讲也就是设置文件或目录的ACL来修改权限。

如果针对某个目录设置了ACL，则目录中的文件会继承其ACL，若针对文件设置了ACL，则文件不再继承其所在目录的ACL。

- setfacl
  
  用于管理文件的```ACL```规则，格式为```setfacl [参数] 文件名称 ```。使用```ls```命令查看的时候可以看到文件的权限最后一个点```(.)```变成了加号```(+)```，就该文件已经设置了```ACL```了。

  常用参数

  - 针对目录文件需要使用-R递归参数
  - 针对普通文件则使用-m参数
  - 如果想要删除某个文件的ACL，则可以使用-b参数

- getfacl
  
  用于显示文件上设置的```ACL```信息，格式为```getfacl 文件名称```

- 添加普通用户进入/root的权限

  ```
  [root@VM_0_11_centos dev]# setfacl -Rm u:test:rwx /root

  [test@VM_0_11_centos /]$ ll -d root
  dr-xrwx---+ 11 root root 4096 Apr  6 20:05 root

  [root@VM_0_11_centos /]# setfacl -b root

  [test@VM_0_11_centos /]$ ll -d root
  dr-xr-x---. 11 root root 4096 Apr  6 20:05 root

  [root@VM_0_11_centos /]# getfacl root
  # file: root
  # owner: root
  # group: root
  user::r-x
  group::r-x
  other::---
  ```

---

### su命令与sudo服务

- su

  用于切换用户， 例如su - test，减号(-)表示完全切换到新的用户，即把环境变量信息也变更为新用户的相应信息，而不是保留原始的信息。

- sudo

  把特定命令的执行权限赋予给指定用户，这样既可保证普通用户能够完成特定的工作，也可以避免泄露root管理员密码，格式为```sudo [参数] 命令名称```。

  常用参数
  - -h，列出帮助信息
  - -l，列出当前用户可执行的命令
  - -u，用户名或UID值以指定的用户身份执行命令
  - -k，清空密码的有效时间，下次执行sudo时需要再次进行密码验证
  - -b，在后台执行指定的命令
  - -p，更改询问密码的提示语

  使用visudo开启用户的```sudo```服务，类似于vim的编辑方式

  ```
  [root@VM_0_11_centos /]# visudo

  // 97行左右，仿照第一行添加第二行，test用户就会拥有sudo服务
  root    ALL=(ALL)       ALL
  test    ALL=(ALL)       ALL

  ```

  如果只想开启部分服务，需要查到服务的路径，然后配置即可，例如只开启```cat```服务，查到它的路径，再配置```sudo```服务即可，此外可以配置免验证密码执行```sudo```命令。

  ```
  [test@VM_0_11_centos ~]$ whereis cat
  cat: /usr/bin/cat /usr/share/man/man1/cat.1.gz
   
  root    ALL=(ALL)       ALL
  test    ALL=(ALL)       /usr/bin/cat
  // 免密码执行sudo
  // test    ALL=NOPASSWD:       /usr/bin/cat

  [test@VM_0_11_centos ~]$ cat /etc/shadow
  cat: /etc/shadow: Permission denied
  [test@VM_0_11_centos ~]$ sudo cat /etc/shadow

  ```