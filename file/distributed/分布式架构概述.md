### 分布式架构概述
近年来因为互联网发展的很快，因此系统的规模也越来越大，分布式系统也越来越多，在<<分布式系统概念与设计>>一书中对分布式系统概念比较正式的说法是```分布式系统是一个硬件或软件组件分布在不同的网络计算机上,彼此之间仅仅通过消息传递进行通信和协调的系统```，实际上简单理解来看就是从原来的单机应用上进行扩展，在多台服务器上部署多个节点，比如数据库的主从备份、Zookeeper和Eureka等框架的使用，都是分布式的应用。

#### 1.分布式系统特征
- 分布性

  会部署在多台不同的服务器上，而这些服务器可以任意分布，可能不在同一个机房，不在同一个地区，甚至不在同一个国家。

- 对等性

  在分布式系统中，所有的服务器都没有主从之分，每台服务器都是对象的，每台服务器上都存储相同的数据作为冗余数据，也就是副本(Replica)的概念，这样子做也是为了保证分布式系统的高可用性。

- 并发性

  因为分布在多个服务器上，每个服务器上都存了相同的冗余数据，操作其中一个服务器上的数据是也必须要保证其它服务器上的数据，这样也就会产生并发问题，并发问题往往都是所有分布式系统中无法避免也必须要处理的问题。

- 缺乏全局时钟

  因为有分布在不同地区的服务器，并且每台服务器都是对等的，都存储了相同的冗余数据，服务器之间又会相互通信来保证整个分布式系统的正常运转，因此谁先操作，谁后操作都很难控制，缺少一个全局的时钟序列控制。

#### 2.分布式系统的问题

- 通信异常

  如果是单机系统，那么所有的系统间的通信都在同一台服务器，速度会非常快，通常在纳秒级别，但是如果是分布式系统，按上面的说法可能服务器都不在相同的国家，互相通信都要依靠网络，而网络是很有可能出问题的，会发生延迟甚至是中断，这个时候整个分布式系统里面的各个节点就无法正常通信了。

- 网络分区(脑裂)

  这种情况其实也就是上面说的网络发生中断，一部分的节点无法使用，整个分布式系统只依靠部分还可以使用的节点来完成工作。

- 三态

  这里是指响应状态，在原本的单机系统中，同一个项目互相调用方法，一定会有一个明确的响应，成功还是失败，但是如果是分布式系统，远程调用另一个服务的方法则还会发生另一种状态，超时状态，这个时候很难判断到底是成功了没返回结果，还是请求就没成功。

- 节点故障

  分布式系统中每台服务器都很有可能会出故障，这个时候就要处理这种故障节点，让请求全部分流到可用服务器上。

---

## 分布式事务

事务这个概念在使用数据库的时候应该已经很熟悉了，ACID，也就是所谓的原子性、一致性、隔离性、持久性。事务可以很好的解决并发问题以及一些异常回滚的情况，因此分布式系统也有着事务的概念，但是分布式系统中的事务就复杂了很多。

#### 1.CAP定理
要了解分布式事务必须先了解CAP定理，也就是下面的三条，分布式系统中只能保证同时满足其中的两种，一般实在C和A之间做取舍，毕竟如果舍去了P，也就是舍弃了多个节点的部署方式，那也就不在是分布式系统了。

- Consistency(一致性)

  分布式系统会有多个节点，数据分别存储在不同的节点里，不同的节点里的数据是否一致就是一致性问题，注意这里的是否一致是说的强一致。

- Partition tolerance(分区容错)

  分布式，顾名思义就是会把多个节点分布在多个区域，即使一个节点宕机了，其他的节点还可以正常使用。

- Availability(可用性)

  指的是分布式系统的可用性，无论什么时候访问哪个分区时，系统都可以访问。

#### 2.BASE理论
BASE理论则是针对分布式系统提出的一套理论，其核心思想是即使无法做到强一致性(Strong consistency),但每个应用都可以根据自身的业务特点,采用适当的方式来使系统达到最终一致性。

- Basically Available

  基本可用

- Soft Stat
  
  软状态，状态可以有一段时间不同步

- Eventually Consistent

  最终一致，最终数据是一致的就可以了，而不是时时保持强一致。


#### 3.最终一致性的类型
- 因果一致性(Causal consistency)

  A更新数据之后通知B，B再获取数据时可以拿到A更新后的最新值，没有通知C，C就不一定拿得到最新值。

- 读已之所写(Read your writes)

  A更新完数据之后，它自己总是能读取到最新的数据。

- 会话一致性(Session consistency)

  在一个会话内修改了数据，在本会话之内一定能读取到最新数据。

- 单调读一致性(Monotonic read consistency)

  如果A在一个系统中读取了一个值，那么后续A在该系统之内所有的读取都不会出去读取到更旧的值。

- 单调写一致性( Monotonic write consistency)

  系统需要保证来自同一个进程的写操作都是按顺序执行的。